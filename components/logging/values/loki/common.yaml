loki:
  image:
    registry: docker-registry.svc.toolforge.org
  schemaConfig:
    configs:
      - from: 2024-04-01
        store: tsdb
        object_store: s3
        schema: v13
        index:
          prefix: loki_index_
          period: 24h
  ingester:
    chunk_encoding: snappy
  tracing:
    enabled: true
  limits_config:
    retention_period: 336h  # 14d
  compactor:
    working_directory: /data/retention
    compaction_interval: 10m
    retention_enabled: true
    retention_delete_delay: 2h
    retention_delete_worker_count: 150
    delete_request_store: s3

networkPolicy:
  enabled: true
  ingress:
    podSelector:
      matchLabels:
        app.kubernetes.io/name: alloy
    namespaceSelector:
      matchLabels:
        kubernetes.io/metadata.name: alloy

gateway:
  enabled: false
lokiCanary:
  enabled: false
test:
  enabled: false
sidecar:
  rules:
    enabled: false

# TODO: Evaluate whether we need these. For now, these use a separate memcached
# image we've not copied to the Toolforge registry.
chunksCache:
  enabled: false
resultsCache:
  enabled: false

# tools and toolsbeta operate in the simple scalable mode. This is the default,
# but listed out here regardless.
deploymentMode: SimpleScalable

backend:
  # This too is the default.
  replicas: 3

  # Work around lack of persistent storage in our clusters.
  persistence:
    volumeClaimsEnabled: false
